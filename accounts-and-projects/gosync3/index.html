
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="canonical" href="https://osg-htc.org/research-facilitation/accounts-and-projects/gosync3/">
      
      <link rel="icon" href="../../img/favicon.ico">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-7.1.0">
    
    
      
        <title>GoSync3 - OSG Research Faciliation</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.33e2939f.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.ef6f36e2.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style>
      
    
    
    
      <link rel="stylesheet" href="../../css/extra.css">
    
    
      
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    <script>function __prefix(e){return new URL("../..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#gosync3" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="OSG Research Faciliation" class="md-header__button md-logo" aria-label="OSG Research Faciliation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            OSG Research Faciliation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              GoSync3
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        
<a href="https://github.com/osg-htc/research-facilitation/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="OSG Research Faciliation" class="md-nav__button md-logo" aria-label="OSG Research Faciliation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    OSG Research Faciliation
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/osg-htc/research-facilitation/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" >
      
      <label class="md-nav__link" for="__nav_2">
        General
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="General" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          General
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../general/cvmfs/" class="md-nav__link">
        CVMFS
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" checked>
      
      <label class="md-nav__link" for="__nav_3">
        Accounts and Groups
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Accounts and Groups" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Accounts and Groups
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../general/" class="md-nav__link">
        General
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../accounts/" class="md-nav__link">
        Accounts
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../projects/" class="md-nav__link">
        Projects
      </a>
    </li>
  

          
            
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          GoSync3
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        GoSync3
      </a>
      
        
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#assumptions" class="md-nav__link">
    Assumptions
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#work-flow" class="md-nav__link">
    Work flow
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prerequisites" class="md-nav__link">
    Prerequisites
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuration" class="md-nav__link">
    Configuration
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#execute-code" class="md-nav__link">
    Execute code
  </a>
  
    <nav class="md-nav" aria-label="Execute code">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#syncing-user-and-groups-gosync_globus_authpy" class="md-nav__link">
    Syncing User and Groups - gosync_globus_auth.py
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#adding-group-add_connect_grouppy" class="md-nav__link">
    Adding Group - add_connect_group.py
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#globus-interface-globus_dbpy" class="md-nav__link">
    Globus Interface - globus_db.py
  </a>
  
    <nav class="md-nav" aria-label="Globus Interface - globus_db.py">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#client-methods-and-some-explanation-about-various-globus-tokens" class="md-nav__link">
    Client Methods and some explanation about various Globus tokens
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#group-methods" class="md-nav__link">
    Group Methods
  </a>
  
    <nav class="md-nav" aria-label="Group Methods">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#retrieving-group-infomation-get-methods" class="md-nav__link">
    Retrieving Group Infomation - GET Methods
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#adding-group-information-post-methods" class="md-nav__link">
    Adding Group Information - POST Methods
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#group-membership-methods" class="md-nav__link">
    Group Membership Methods
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#user-methods" class="md-nav__link">
    User Methods
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#puppethiera-interface-connect_dbpy" class="md-nav__link">
    Puppet/Hiera Interface - connect_db.py
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#future-plans" class="md-nav__link">
    Future Plans
  </a>
  
    <nav class="md-nav" aria-label="Future Plans">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#work-flow-improvements" class="md-nav__link">
    Work flow Improvements
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#put-and-push-methods-for-globus-interface" class="md-nav__link">
    PUT and PUSH Methods for Globus Interface
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#moving-connect-db-to-a-real-db" class="md-nav__link">
    Moving connect DB to a real DB
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#multiple-connect-globus-apps" class="md-nav__link">
    Multiple Connect Globus Apps
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" >
      
      <label class="md-nav__link" for="__nav_4">
        Midscale Engagements
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Midscale Engagements" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Midscale Engagements
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_1" type="checkbox" id="__nav_4_1" >
      
      <label class="md-nav__link" for="__nav_4_1">
        SPT
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="SPT" data-md-level="2">
        <label class="md-nav__title" for="__nav_4_1">
          <span class="md-nav__icon md-icon"></span>
          SPT
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../midscale-engagements/spt/general/" class="md-nav__link">
        General
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../midscale-engagements/spt/cvmfs/" class="md-nav__link">
        CVMFS
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_2" type="checkbox" id="__nav_4_2" >
      
      <label class="md-nav__link" for="__nav_4_2">
        VERITAS
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="VERITAS" data-md-level="2">
        <label class="md-nav__title" for="__nav_4_2">
          <span class="md-nav__icon md-icon"></span>
          VERITAS
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../midscale-engagements/veritas/general/" class="md-nav__link">
        General
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../midscale-engagements/veritas/cvmfs/" class="md-nav__link">
        CVMFS
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_3" type="checkbox" id="__nav_4_3" >
      
      <label class="md-nav__link" for="__nav_4_3">
        XENON
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="XENON" data-md-level="2">
        <label class="md-nav__title" for="__nav_4_3">
          <span class="md-nav__icon md-icon"></span>
          XENON
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../midscale-engagements/xenon/general/" class="md-nav__link">
        General
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../midscale-engagements/xenon/cvmfs/" class="md-nav__link">
        CVMFS
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" type="checkbox" id="__nav_5" >
      
      <label class="md-nav__link" for="__nav_5">
        Documentation
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Documentation" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Documentation
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../documentation/freshdesk/" class="md-nav__link">
        Freshdesk
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#assumptions" class="md-nav__link">
    Assumptions
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#work-flow" class="md-nav__link">
    Work flow
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prerequisites" class="md-nav__link">
    Prerequisites
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuration" class="md-nav__link">
    Configuration
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#execute-code" class="md-nav__link">
    Execute code
  </a>
  
    <nav class="md-nav" aria-label="Execute code">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#syncing-user-and-groups-gosync_globus_authpy" class="md-nav__link">
    Syncing User and Groups - gosync_globus_auth.py
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#adding-group-add_connect_grouppy" class="md-nav__link">
    Adding Group - add_connect_group.py
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#globus-interface-globus_dbpy" class="md-nav__link">
    Globus Interface - globus_db.py
  </a>
  
    <nav class="md-nav" aria-label="Globus Interface - globus_db.py">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#client-methods-and-some-explanation-about-various-globus-tokens" class="md-nav__link">
    Client Methods and some explanation about various Globus tokens
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#group-methods" class="md-nav__link">
    Group Methods
  </a>
  
    <nav class="md-nav" aria-label="Group Methods">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#retrieving-group-infomation-get-methods" class="md-nav__link">
    Retrieving Group Infomation - GET Methods
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#adding-group-information-post-methods" class="md-nav__link">
    Adding Group Information - POST Methods
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#group-membership-methods" class="md-nav__link">
    Group Membership Methods
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#user-methods" class="md-nav__link">
    User Methods
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#puppethiera-interface-connect_dbpy" class="md-nav__link">
    Puppet/Hiera Interface - connect_db.py
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#future-plans" class="md-nav__link">
    Future Plans
  </a>
  
    <nav class="md-nav" aria-label="Future Plans">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#work-flow-improvements" class="md-nav__link">
    Work flow Improvements
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#put-and-push-methods-for-globus-interface" class="md-nav__link">
    PUT and PUSH Methods for Globus Interface
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#moving-connect-db-to-a-real-db" class="md-nav__link">
    Moving connect DB to a real DB
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#multiple-connect-globus-apps" class="md-nav__link">
    Multiple Connect Globus Apps
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/osg-htc/research-facilitation/edit/master/docs/accounts-and-projects/gosync3.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                <h1 id="gosync3">GOSync3<a class="headerlink" href="#gosync3" title="Permanent link">&para;</a></h1>
<p>GOSync3 is the replacement for the original GOSync. It is based on the 
<a href="http://globus-sdk-python.readthedocs.io/en/latest/">Globus SDK</a>, the 
<a href="https://github.com/sirosen/globus-nexus-client/tree/master/globus_nexus_client">Globus SDK-based Globus Nexus Client</a>, 
and puppet/hiera to create and manage UNIX users and groups. The main tasks of 
these classes and scripts are to interact with the GlobusID and Globus Groups 
database through their RESTful API and manage the JSON file that 
puppet/hiera requires for creating and managing user accounts. </p>
<p>The original GOSync is based on the 
<a href="https://github.com/globusonline/python-nexus-client">Globus Nexus Python library</a>. 
The Globus Nexus Python library has been officially deprecated. An improved 
version of the original GOSync, i.e. GOSync2, was under development. It was 
still based on the Globus Nexus Python library. The development was abandoned 
as Globus has moved to a OAuth2-based authentication model and access to a 
user's GlobusID.</p>
<p>Important notes READ BEFORE USING:</p>
<ul>
<li>This is a BETA. It does not have all the necessary features to act as a full 
replacement yet.</li>
<li>This version uses Globus Nexus client based on the Globus SDK created by 
Stephen Rosen. This is not an official product of the Globus team. It is 
maintained though.</li>
</ul>
<h2 id="assumptions">Assumptions<a class="headerlink" href="#assumptions" title="Permanent link">&para;</a></h2>
<p>Following assumptions are made in the code:</p>
<ul>
<li>All users are part of the <code>connect</code> Globus Group</li>
<li>The <code>connect</code> user is an <code>admin</code> or <code>manager</code> in all relevant groups</li>
</ul>
<h2 id="work-flow">Work flow<a class="headerlink" href="#work-flow" title="Permanent link">&para;</a></h2>
<p>The GOSync3 work flow is meant to operate without human intervention, i.e. as a 
<code>cron</code> job, besides the normal user approval process. At the moment, there is 
no connection between account applications and GOSync3. Hence, there is no way 
of knowing which user is new, updated his/her profile, or changed their group 
membership. This should change in the future, see the last section for details.</p>
<p>In the current work flow, GOSync3 retrieves all groups in which the <code>connect</code> 
user is an <code>Administrator</code> or <code>Manager</code>. The <code>connect</code> user acts like the root 
user in a UNIX operating system. In addition to the group name and the UUID 
assigned by Globus Groups, the number of active members is being fetched by 
querying the group's summary from Globus.  </p>
<p>For creating and updating users the work flow is more complicated. First, 
GOSync3 retrieves all users and their profile associated with the root group, 
i.e. <code>connect</code>. It is necessary to fetch the user profile because it contains 
the user's SSH key. To determine the the user's group membership, the the group 
to users mapping is generated by looping through all groups getting their group 
members. FRom this mapping a user to groups mapping is generated. With the 
necessary information in hand, it the user information in the JSON object is 
created or updated.</p>
<h2 id="prerequisites">Prerequisites<a class="headerlink" href="#prerequisites" title="Permanent link">&para;</a></h2>
<p>GOSync3 requires at least Python 2.7 and Python packages:</p>
<div class="codehilite"><pre><span></span><code><span class="n">globus</span><span class="o">-</span><span class="n">sdk</span><span class="o">[</span><span class="n">jwt</span><span class="o">]&gt;=</span><span class="mf">1.0</span><span class="p">,</span><span class="o">&lt;</span><span class="mf">2.0</span><span class="w"></span>
<span class="n">globus</span><span class="o">-</span><span class="n">nexus</span><span class="o">-</span><span class="n">client</span><span class="o">&gt;=</span><span class="mf">0.2.5</span><span class="w"></span>
</code></pre></div>

<p><code>globus-sdk[jwt]&gt;=1.0,&lt;2.0</code> is the Globus SDK including the 
<a href="https://jwt.io/">JSON Web Token (JWT)</a> library. JWT is necessary to interact 
with Globus Auth and be able to do token introspection. 
<code>globus-nexus-client&gt;=0.2.5</code> is an implementation of the Nexus client using the 
Globus SDK. It is not an official Globus product, but supported by one of the 
authors (Stephen Rosen) of the Globus SDK.</p>
<p>In addition to the Python packages, one will need a Globus Confidential 
application, see <a href="https://docs.globus.org/api/auth/developer-guide/">here</a> for 
details, that:</p>
<ul>
<li>Includes the user-granted permissions ("scopes"):<ul>
<li><code>openid</code></li>
<li><code>profile</code></li>
<li><code>email</code></li>
<li><code>urn:globus:auth:scope:auth.globus.org:view_identity_set</code></li>
<li><code>urn:globus:auth:scope:auth.globus.org:view_identities</code></li>
<li><code>urn:globus:auth:scope:transfer.api.globus.org:all</code></li>
<li><code>urn:globus:auth:scope:auth.globus.org:view_ssh_public_keys</code></li>
</ul>
</li>
<li>Is allowed to use the Group scopes. This requires filing a ticket with Globus 
to get the app ID added to the system</li>
<li>Has the correct redirection URLs (this depends on the website you are running)</li>
<li>Requires the GlobusID as an identity provider</li>
<li>Has a secret associated with the application</li>
</ul>
<p>For more details, please see the 
<a href="https://globus-sdk-python.readthedocs.io/en/latest/tutorial.html">Globus SDK documentation</a>. </p>
<h2 id="configuration">Configuration<a class="headerlink" href="#configuration" title="Permanent link">&para;</a></h2>
<p>The configuration is a JSON file for ease of parsing it as a dictionary. The 
minimal configuration needed is:</p>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
  <span class="s">&quot;users&quot;</span><span class="o">:</span> <span class="p">{</span>
    <span class="s">&quot;passwd_file&quot;</span><span class="o">:</span> <span class="o">&lt;</span><span class="n">passwd_file_to_be_used</span><span class="o">&gt;</span>
    <span class="s">&quot;default_group&quot;</span><span class="o">:</span> <span class="o">&lt;</span><span class="n">default_group</span> <span class="k">for</span> <span class="n">users</span><span class="o">&gt;</span>
  <span class="p">},</span>
  <span class="s">&quot;groups&quot;</span><span class="o">:</span> <span class="p">{</span>
    <span class="s">&quot;group_file&quot;</span><span class="o">:</span> <span class="o">&lt;</span><span class="n">group_file_to_be_used</span><span class="o">&gt;</span>
  <span class="p">},</span>
  <span class="s">&quot;globus&quot;</span><span class="o">:</span> <span class="p">{</span>
    <span class="s">&quot;groups&quot;</span><span class="o">:</span> <span class="p">{</span>
      <span class="s">&quot;root_group&quot;</span><span class="o">:</span> <span class="o">&lt;</span><span class="n">root_group</span><span class="o">&gt;</span><span class="p">,</span>
      <span class="s">&quot;root_group_uuid&quot;</span><span class="o">:</span> <span class="o">&lt;</span><span class="n">root_group_globus_uuid</span><span class="o">&gt;</span>
    <span class="p">},</span>
    <span class="s">&quot;root_user&quot;</span><span class="o">:</span> <span class="p">{</span>
      <span class="c1">// root user should only have admin or manager roles in the groups</span>
      <span class="s">&quot;roles&quot;</span><span class="o">:</span> <span class="p">[</span>
        <span class="s">&quot;admin&quot;</span><span class="p">,</span>
        <span class="s">&quot;manager&quot;</span>
      <span class="p">],</span>
      <span class="s">&quot;username&quot;</span><span class="o">:</span> <span class="o">&lt;</span><span class="n">root_user</span><span class="o">&gt;</span><span class="p">,</span>
      <span class="s">&quot;secret&quot;</span><span class="o">:</span> <span class="o">&lt;</span><span class="n">root_user_passwd</span><span class="o">&gt;</span><span class="p">,</span>
      <span class="s">&quot;auth_refresh_token&quot;</span><span class="o">:</span> <span class="o">&lt;</span><span class="n">root_user_globus_auth_token_for_app</span><span class="o">&gt;</span><span class="p">,</span>
      <span class="s">&quot;nexus_refresh_token&quot;</span><span class="o">:</span> <span class="o">&lt;</span><span class="n">root_user_globus_nexus_token_for_app</span><span class="o">&gt;</span>
    <span class="p">},</span>
    <span class="s">&quot;user&quot;</span><span class="o">:</span> <span class="p">{</span>
      <span class="c1">// regular user may have any role in a group</span>
      <span class="s">&quot;roles&quot;</span><span class="o">:</span> <span class="p">[</span>
        <span class="s">&quot;member&quot;</span><span class="p">,</span>
        <span class="s">&quot;admin&quot;</span><span class="p">,</span>
        <span class="s">&quot;manager&quot;</span>
      <span class="p">]</span>
    <span class="p">},</span>
    <span class="s">&quot;app&quot;</span><span class="o">:</span> <span class="p">{</span>
      <span class="s">&quot;scopes&quot;</span><span class="o">:</span> <span class="p">[</span>
        <span class="s">&quot;openid&quot;</span><span class="p">,</span>
        <span class="s">&quot;profile&quot;</span><span class="p">,</span>
        <span class="s">&quot;email&quot;</span><span class="p">,</span>
        <span class="s">&quot;urn:globus:auth:scope:auth.globus.org:view_identities&quot;</span><span class="p">,</span>
        <span class="s">&quot;urn:globus:auth:scope:transfer.api.globus.org:all&quot;</span><span class="p">,</span>
        <span class="s">&quot;urn:globus:auth:scope:auth.globus.org:view_identity_set&quot;</span><span class="p">,</span>
        <span class="s">&quot;urn:globus:auth:scope:nexus.api.globus.org:groups&quot;</span>
      <span class="p">],</span>
      <span class="s">&quot;client_id&quot;</span><span class="o">:</span> <span class="o">&lt;</span><span class="n">globus_app_id_as_string</span><span class="o">&gt;</span><span class="p">,</span>
      <span class="s">&quot;client_secret&quot;</span><span class="o">:</span> <span class="o">&lt;</span><span class="n">globus_app_secret_as_string</span><span class="o">&gt;</span>
    <span class="p">}</span>
  <span class="p">},</span>
  <span class="s">&quot;connect_db&quot;</span><span class="o">:</span> <span class="p">{</span>
    <span class="s">&quot;db_file&quot;</span><span class="o">:</span> <span class="o">&lt;</span><span class="n">json_file_to_be_used_as_connect_db</span><span class="o">&gt;</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<p>This JSON object will be parsed into a Python dictionary and will be passed to 
the various classes.</p>
<h2 id="execute-code">Execute code<a class="headerlink" href="#execute-code" title="Permanent link">&para;</a></h2>
<h3 id="syncing-user-and-groups-gosync_globus_authpy">Syncing User and Groups - <code>gosync_globus_auth.py</code><a class="headerlink" href="#syncing-user-and-groups-gosync_globus_authpy" title="Permanent link">&para;</a></h3>
<p>Executing <code>gosync_globus_auth.py</code> will sync the users and groups from Globus. 
If you want to run with you own config: 
<code>./gosync_globus_auth.py --config /path/to/config</code>. If you want to increase the 
verbosity, default the program will not print out anything to screen, simply 
add the <code>-v</code> flag. To increase the verbosity, just add more <code>v</code>s, i.e. <code>-vvvv</code>.</p>
<h3 id="adding-group-add_connect_grouppy">Adding Group - <code>add_connect_group.py</code><a class="headerlink" href="#adding-group-add_connect_grouppy" title="Permanent link">&para;</a></h3>
<p>To add a group to Globus Groups requires, a file formatted as provided by the 
OSG Connect Website, details below. With the groups project file, a group is 
added through executing 
<code>./add_connect_group.py --projectfile /path/to/file --parent &lt;parent_group&gt;</code>. 
The <code>--parent &lt;parent_group&gt;</code> is optional, but necessary to maintain the group 
tree structure and determine the correct group name in Globus. To pass your own 
configuration you will need to the <code>--config /path/to/new/config</code> option. There 
is also a verbosity flag, i.e. <code>-v</code>, <code>-vv</code>, and <code>-vvv</code>. </p>
<h2 id="globus-interface-globus_dbpy">Globus Interface - <code>globus_db.py</code><a class="headerlink" href="#globus-interface-globus_dbpy" title="Permanent link">&para;</a></h2>
<p>The class <code>globus_db</code> is meant as an interface to the Globus ID and Globus 
Groups services. Please note that being able to <code>PUT</code> and <code>PUSH</code> information 
into Globus Groups is possible through the Nexus interface. Currently, only 
the <code>PUT</code> for Globus Groups is supported.</p>
<p>The class requires a configuration dictionary and an <code>connect_db</code> object. The 
configuration dictionary is explained above. The <code>connect_db</code> is needed to 
retrieve the the refresh tokens for users and allow of to check for changes 
in group membership, i.e. if users were added or removed from a group.</p>
<p>The class is split into four sections: client methods, group methods, group 
membership methods, and user methods.</p>
<h3 id="client-methods-and-some-explanation-about-various-globus-tokens">Client Methods and some explanation about various Globus tokens<a class="headerlink" href="#client-methods-and-some-explanation-about-various-globus-tokens" title="Permanent link">&para;</a></h3>
<p>The client methods are for getting the different types of clients needed to 
interact with GlobusID through Globus Auth and Globus Groups through Globus 
Nexus. There are two main clients used: Globus Auth client and Globus Nexus 
client. The Globus Auth client is for interacting with the user's GlobusID, i.e 
get the user profile in GlobusID. The Globus Nexus client is for interacting 
with a user's Globus Groups and their Globus Groups's profile.</p>
<p>The clients can be authenticated using Globus Auth tokens or Globus Online Auth 
legacy tokens. Tokens can be thought of as randomly generated passwords that 
encode the user's identity and the application's permission level. Globus 
Online Auth legacy tokens will be referred to as legacy tokens from here on 
out. Legacy tokens should be avoided at all cost. They may not work down the 
road and are bad practice.</p>
<p>Globus Auth tokens are OAuth2 tokens. OAuth2 gives the user and the 
authorization server the explicit power to reject or limit (either in time or 
scope) an application's access, to the user's information. It also moves large 
parts of the authentication process from the resource provider to an 
authentication provider, which allows for better separation between resources 
and authentication. For more details please visit 
<a href="https://www.digitalocean.com/community/tutorials/an-introduction-to-oauth-2">An introduction to OAuth2</a>. </p>
<p>The Globus Auth tokens are split into three different types: Auth, Transfer, 
and Nexus. One will receive one, two, or all three, when a user authenticates 
against the app depending on an app's scopes, i.e. requested permissions. With 
the app created in the prerequisites one will receive all three tokens. Auth 
tokens are meant for retrieving a user's information from Globus ID, i.e. 
linked identities, SSH keys, etc. Transfer tokens are for initiating Globus 
transfers on behalf of the user. Nexus tokens are for authorizing against the 
Globus Groups service to allow viewing a user's group membership. The Nexus 
tokens do not allow to view a user's Globus groups profile through a call to 
the user's Globus Nexus profile, i.e. the group-specific custom fields and the 
user identity, directly. This due to the Nexus group scope not having the 
permissions to view the user's GlobusID. This can be circumvented by through 
accessing the profile through the groups interface instead. I know... Please 
note that Nexus tokens are special. They are not officially available, one 
has to request access to the "group" scopes from Globus. </p>
<p>Globus Auth tokens expire after some time, usually within 10 minutes, i.e. you 
as the application only have a limited amount of time to retrieve the desired 
information out of Globus. To be able to repeatedly authenticate with Globus 
Auth, one can request "refresh tokens". These tokens are valid until the user 
revokes an app's permission. These are required for GOSync3.</p>
<p>The individual methods are self-explanatory:</p>
<ul>
<li><code>get_tokens</code>: Returns a user's tokens from the <code>connect_db</code> or retrieves 
the tokens from the configuration file for the root user.</li>
<li><code>get_legacy_client</code>: Returns a user's Nexus client that has been 
authenticated using legacy Globus Online Auth token, i.e. the 
user's username/password.</li>
<li><code>get_globus_client</code>: Returns the user's Globus Auth and Globus Nexus client 
authenticated using the user's refresh tokens. </li>
</ul>
<h3 id="group-methods">Group Methods<a class="headerlink" href="#group-methods" title="Permanent link">&para;</a></h3>
<h4 id="retrieving-group-infomation-get-methods">Retrieving Group Infomation - <code>GET</code> Methods<a class="headerlink" href="#retrieving-group-infomation-get-methods" title="Permanent link">&para;</a></h4>
<p>There are two ways to access all groups associated with <code>connect</code>. The first is 
to the retrieve the group tree for the root group, named <code>connect</code>. The second 
is to retrieve all groups associated with the root user, also named <code>connect</code>. </p>
<p>In GOSyn3, we are using the second method. There is a method to retrieve the 
group tree, but it is unused at the moment. The <code>get_group</code> and <code>get_groups</code> 
method simply filter the <code>all_groups</code> list for the desired group(s). 
<code>get_all_groups</code> is the method that uses the root user's credentials to 
determine groups in which the root user, <code>connect</code>, is an <code>admin</code> or <code>manager</code>. 
The distinction between between being <code>admin</code>, <code>manager</code>, or <code>member</code> is 
important here. It filters the groups that are returned by Globus Nexus. The 
<code>connect</code> user will always be an <code>admin</code> or <code>manager</code> in a subgroup, while a 
user might be a <code>admin</code>, <code>manager</code>, or <code>member</code>. The root user is a <code>member</code> 
of some groups that are not associated with the Connect instances. </p>
<p>In addition there is a <code>check_new_members</code> methods at is currently used. It 
allows to filter the group list to those groups that have recently added members. </p>
<h4 id="adding-group-information-post-methods">Adding Group Information - <code>POST</code> Methods<a class="headerlink" href="#adding-group-information-post-methods" title="Permanent link">&para;</a></h4>
<p>GOSync3 has the ability to add groups to Globus Groups. This is done through 
the <code>add_group</code> and <code>parse_project_file</code> methods. Adding a group is done 
through the <code>add_groups</code> method. It calls the <code>globus-nexus-client</code>'s 
<code>create_group</code> method to create the group with name and description provided 
through the project description text file, details on this below. Optionally, 
one can pass a parent group to the method. It is strongly recommended to 
provide a parent group, without a group the group will be assumed to be a 
top-level group below the root <code>connect</code> group. </p>
<p>The project description text file should follow the format of the form on the 
<a href="http://osgconnect.net/newproject">New Project section on the OSG Connect website</a>. 
This will provide a text file of the following format:</p>
<div class="codehilite"><pre><span></span><code><span class="nv">Your</span> <span class="nv">Name</span>: 
<span class="nv">Your</span> <span class="nv">Email</span> <span class="nv">Address</span>: 
<span class="nv">Project</span> <span class="nv">Name</span>: 
<span class="nv">Short</span> <span class="nv">Project</span> <span class="nv">Name</span>: 
<span class="nv">Field</span> <span class="nv">of</span> <span class="nv">Science</span>: <span class="nv">Evolutionary</span> 
<span class="nv">Field</span> <span class="nv">of</span> <span class="nv">Science</span> <span class="ss">(</span><span class="k">if</span> <span class="nv">Other</span><span class="ss">)</span>: 
<span class="nv">PI</span> <span class="nv">Name</span>: 
<span class="nv">PI</span> <span class="nv">Email</span>:
<span class="nv">PI</span> <span class="nv">Organization</span>:
<span class="nv">PI</span> <span class="nv">Department</span>:
<span class="nv">Join</span> <span class="nv">Date</span>: 
<span class="nv">Sponsor</span>: 
<span class="nv">OSG</span> <span class="nv">Sponsor</span> <span class="nv">Contact</span>: 
<span class="nv">Project</span> <span class="nv">Contact</span>: 
<span class="nv">Project</span> <span class="nv">Contact</span> <span class="nv">Email</span>: 
<span class="nv">Telephone</span> <span class="nv">Number</span>: 
<span class="nv">Project</span> <span class="nv">Description</span>:
</code></pre></div>

<p>From this the only required field is the "Short Project Name". The value will 
be used as the group name in Globus Groups. </p>
<p><code>parse_project_file</code> parses the project file, determines the expected name of 
the group, and converts the plain text to HTML-formatted text. The project name 
is determined from the "Short Project Name" in the project file and the parent 
group. The format of the Globus Groups name is 
<code>&lt;parent_group&gt;.&lt;short_project_name</code>. To make the text HTML-formatted, the 
only action is to converted newline characters (<code>\n</code>) to <code>&lt;br&gt;</code>.</p>
<h3 id="group-membership-methods">Group Membership Methods<a class="headerlink" href="#group-membership-methods" title="Permanent link">&para;</a></h3>
<p>The work flow for retrieving a user's group membership depends on the 
authentication method used. In a purely Globus Auth-based workflow, one would 
retrieve a user's group membership by using their tokens and calling 
<code>list_groups</code> method from the Nexus client. This is done in the function 
<code>get_user_groups_auth</code>.</p>
<p>At the moment, we only have tokens for the <code>connect</code> user. To work around this, 
GOSync3 tries to generate a mapping of group to users first and then inverts 
that mapping, see function <code>get_user_groups_no_tokens</code>. It retrieves the list 
of all groups associated with the <code>connect</code> user and then determines the group 
members for every group. Using <code>_invert_dict_list_values</code>, the group-to-users 
mapping is then inverted to the user-to-groups mapping. </p>
<p><code>get_group_members</code> simply returns the users for a given group. This has to be 
done using the group's Globus UUID. A mapping of Globus group name to Globus 
group UUID is provided by the <code>connect_db</code>.</p>
<h3 id="user-methods">User Methods<a class="headerlink" href="#user-methods" title="Permanent link">&para;</a></h3>
<p>The user methods allow the user to retrieve more information about user, i.e. 
query Globus for the user's "user information" and manipulate the Globus output 
in a more easily digestible patterns. </p>
<p><code>get_user_info</code> is a specialization of <code>get_user_groups_profile</code>. It allows to 
fetch the a user's profile, i.e. username, SSH key, group-specific information, 
full name, e-mail, through Globus Groups. <code>get_user_info</code> is specialization in 
the sense that it uses the root group user profile rather than specific group's 
profile as needed by <code>get_user_groups_profile</code>.</p>
<p><code>get_all_users</code> retrieves all the users in the root group and then queries 
Globus Groups for the user's profile. <code>_invert_dict_list_values</code> allows you 
to invert the group to users mapping to a user to groups mapping.</p>
<h2 id="puppethiera-interface-connect_dbpy">Puppet/Hiera Interface - <code>connect_db.py</code><a class="headerlink" href="#puppethiera-interface-connect_dbpy" title="Permanent link">&para;</a></h2>
<p>In this case, the JSON file used by puppet/hiera is used as a user database. 
This is suboptimal. It will allow us to quickly deploy GOSync3. The information 
source for the puppet/hiera JSON file can be replaced by a real DB later on. 
Some of the information, i.e. UNIX ids, stored in the JSON file will be needed 
to populate a replacement database.</p>
<p>The puppet/hiera interface, i.e <code>connect_db</code>, is a thin layer of the JSON 
object that puppet/hiera uses to provision user accounts. It reads a previous 
version of the JSON object, and produces a <code>users</code> and <code>groups</code> dictionary and 
a <code>uids</code> and <code>gids</code> list. These four objects contain all the necessary 
information to be able add new groups and users to the JSON object passed 
to puppet/hiera.</p>
<p>The <code>users</code> and <code>groups</code> dictionaries are made up of sub-dictionaries. Holding 
the information for each user and group, respectively. The <code>users</code> dictionary 
is a mapping of username to user information, such that:</p>
<div class="codehilite"><pre><span></span><code>{
    <span class="s2">&quot;</span><span class="s">auth_refresh_token</span><span class="s2">&quot;</span>: # <span class="nv">user</span><span class="s1">&#39;</span><span class="s">s Globus Auth refresh token</span>
    <span class="s2">&quot;</span><span class="s">comment</span><span class="s2">&quot;</span>: # <span class="nv">user</span><span class="s1">&#39;</span><span class="s">s name</span>
    <span class="s2">&quot;</span><span class="s">email</span><span class="s2">&quot;</span>: # <span class="nv">user</span><span class="s1">&#39;</span><span class="s">s emails</span>
    <span class="s2">&quot;</span><span class="s">gid</span><span class="s2">&quot;</span>: # <span class="nv">default</span> <span class="nv">group</span> <span class="k">for</span> <span class="nv">passwd</span> <span class="nv">file</span>
    <span class="s2">&quot;</span><span class="s">manage_group</span><span class="s2">&quot;</span>: # <span class="nv">puppet</span><span class="o">/</span><span class="nv">hiera</span> <span class="nv">config</span> <span class="nv">parameter</span>
    <span class="s2">&quot;</span><span class="s">nexus_refresh_token</span><span class="s2">&quot;</span>: # <span class="nv">user</span><span class="s1">&#39;</span><span class="s">s Globus Nexus refresh token</span>
    <span class="s2">&quot;</span><span class="s">shell</span><span class="s2">&quot;</span>: # <span class="nv">default</span> <span class="nv">user</span> <span class="nv">shell</span>
    <span class="s2">&quot;</span><span class="s">ssh_keys</span><span class="s2">&quot;</span>: # <span class="nv">SSH</span> <span class="nv">key</span> <span class="nv">dictionary</span>, <span class="nv">explained</span> <span class="nv">below</span>
    <span class="s2">&quot;</span><span class="s">uid</span><span class="s2">&quot;</span>: # <span class="nv">user</span><span class="s1">&#39;</span><span class="s">s UNIX id</span>
    <span class="s2">&quot;</span><span class="s">groups</span><span class="s2">&quot;</span>: # <span class="nv">list</span> <span class="nv">of</span> <span class="nv">user</span><span class="s1">&#39;</span><span class="s">s groups,</span>
    <span class="s2">&quot;</span><span class="s">connect_project</span><span class="s2">&quot;</span>:  # <span class="nv">Initial</span> <span class="k">connect</span> <span class="nv">project</span>, <span class="nv">typically</span> <span class="nv">osg</span>.<span class="nv">ConnectTrain</span>
    <span class="s2">&quot;</span><span class="s">condor_schedd</span><span class="s2">&quot;</span>: # <span class="nv">The</span> <span class="nv">condor</span> <span class="nv">schedd</span> <span class="nv">to</span> <span class="nv">pick</span> <span class="nv">on</span> <span class="nv">the</span> <span class="nv">login</span> <span class="nv">host</span>
}
</code></pre></div>

<p>The <code>groups</code> dictionary follows a similar pattern. Mapping a group name to:</p>
<div class="codehilite"><pre><span></span><code>{
    <span class="s2">&quot;</span><span class="s">gid</span><span class="s2">&quot;</span>: # <span class="nv">group</span> <span class="nv">UNIX</span> <span class="nv">ID</span>
    <span class="s2">&quot;</span><span class="s">num_members</span><span class="s2">&quot;</span>: # <span class="nv">Number</span> <span class="k">if</span> <span class="nv">active</span> <span class="nv">user</span> <span class="nv">according</span> <span class="nv">to</span> <span class="nv">Globus</span>
    <span class="s2">&quot;</span><span class="s">globus_uuid</span><span class="s2">&quot;</span>: # <span class="nv">Groups</span> <span class="nv">Globus</span> <span class="nv">UUID</span>
}
</code></pre></div>

<p>Some of the methods in this class are self-explanatory:</p>
<ul>
<li><code>add_group</code>: Add a new group to the <code>groups</code> dictionary</li>
<li><code>add_user</code>: Add a new user to the <code>users</code> dictionary</li>
<li><code>get_user</code>: Retrieve the user information by username</li>
<li><code>get_group</code>: Retrieve the group by group name</li>
<li><code>new_unix_id</code>: This will generate a new UNIX id by incrementing the maximum 
ID or setting it to 100000 for both groups and users</li>
<li><code>get_member_count</code>: Retrieve the group's active member count</li>
<li><code>get_auth_token</code>: Retrieve user's Globus Auth refresh token</li>
<li><code>get_nexus_token</code>: Retrieve user's Globus Nexus refresh token</li>
<li><code>get_globus_tokens</code>: Retrieves user's Globus Auth and Nexus refresh tokens</li>
<li><code>remove_unicode</code>: Remove unicode characters from a user's name. This can 
cause problems when generating a passwd file or trying to serialize a JSON file.</li>
<li><code>commit_old_version</code>: In the spirit of old GOSync, we commit the JSON file to 
Gitlab, so puppet/hiera can grab it from there</li>
<li><code>write_db</code>: Write the JSON object out. If <code>email_file</code> is supplied in the 
config, it will also create a directory with json files that maps the group 
users to their email addresses. Similarly, if <code>mailchimp_file</code> is supplied, 
it will also create a directory with json files that maps the group users to 
their information needed for mailchimp. </li>
<li><code>set_user_nologin</code>: Set a user's shell to nologin, used in case they are no 
longer "active" in a Globus group</li>
<li><code>get_emails</code>: Get email for everyone or optionally for a given group</li>
<li><code>get_email</code>: Get email for a specific user</li>
<li><code>get_mailchimp_info</code>: Gather information about users for mailchimp. Mapping 
users to their, first name, last name, and email address.</li>
</ul>
<p>The <code>get_default_project</code> method is tries to guess a user's first OSG project 
for account reasons. If the user is a member of more than more than one 
sub-project we need to filter out any of the default ones. First, 
"osg.ConnectTrain" is removed. If there are still more than one projects, we 
filter out any project associated with a user school and any OSG project, if the
 user is a member of the other connect instances, i.e. SPT, ATLAS, CMS, and Duke. </p>
<p>The <code>decompose_sshkey</code> method is necessary because of the format that 
puppet/hiera wants the SSH key in. A typical SSH key is formatted as follows:</p>
<div class="codehilite"><pre><span></span><code>&lt;encryption_type&gt; &lt;public_key&gt; &lt;idenitifier&gt;
</code></pre></div>

<p>where the <code>&lt;encryption_type&gt;</code> is the type of SSH key, i.e. ssh-rsa, 
<code>&lt;public_key&gt;</code> is the actual key portion of an SSH key, and <code>&lt;idenitifier&gt;</code> is 
an optional identifier that is usually <code>&lt;username&gt;@&lt;network_hostname&gt;</code> of the 
machine the key pair was generated on. </p>
<p>Puppet/hiera wants the key in this JSON object:</p>
<div class="codehilite"><pre><span></span><code>{
    &quot;&lt;identifier&gt;&quot;:
    {
        &quot;type&quot;: &lt;encryption_type&gt; # Encryption type, i.e. ssh-rsa, ssh-dsa
        &quot;key&quot;: &lt;public_key&gt; # Key part
    }
}
</code></pre></div>

<p>This requires to split the key according to the spaces it in. Unfortunately, 
not all keys have the identifier. In those cases it is replaced with the user's 
email address. This will not affect operations. There is a question though 
about overriding SSH keys. </p>
<h2 id="future-plans">Future Plans<a class="headerlink" href="#future-plans" title="Permanent link">&para;</a></h2>
<h3 id="work-flow-improvements">Work flow Improvements<a class="headerlink" href="#work-flow-improvements" title="Permanent link">&para;</a></h3>
<p>There are three slow processes in the current work flow:</p>
<ul>
<li>Getting the group summary </li>
<li>Getting the user summary</li>
<li>Getting the user group memberships</li>
</ul>
<p>The first processes are slow because we have to query the Globus Groups 
database separately each piece of the group information: group profile, number 
of members, and group members, respectively. In addition, queries on the Globus 
side slow down as the group tree grows in size and as we add more groups the 
more queries we have to perform. Getting the user summary is a similarly 
expensive process because we have to query Globus for every user twice, once 
to get their general information, and another to get their SSH key.</p>
<p>One of the main steps to improve the efficiency requires to change the website 
to use OAuth2. This would allow us to operate on a per-user basis rather than 
on a per-group basis. In an idealized work flow, a user would sign up on the 
website. This sign up process would trigger the ability to retrieve the users 
identity (including their SSH key)and their Globus OAuth tokens, see below for 
more details on Globus OAuth tokens. With the identity and Globus token in 
hand, we can then query Globus for just the new user's group memberships. The 
first query would happen be default at sign up, while the group membership 
query would come after they are approved. The second query may have to be 
repeated several time. This is not wasted effort though, since we are waiting 
for human intervention. Similarly, we could trigger a Globus query of a given 
user's profile once they login. This would make updating the user information 
on our end dependent on user actions rather than us having to repeatedly query 
Globus for their information. Given that we most likely will never have tokens 
for all users, we will need operate in a hybrid mode, where the new user's are 
handled solely through the tokens, while older users will have still have to 
be kept up to date through the above described work flow. </p>
<h3 id="put-and-push-methods-for-globus-interface"><code>PUT</code> and <code>PUSH</code> Methods for Globus Interface<a class="headerlink" href="#put-and-push-methods-for-globus-interface" title="Permanent link">&para;</a></h3>
<p>To create groups in Globus Groups, we will need to implement <code>PUSH</code> methods. 
The <code>NexusClient</code> already has these, but they are untested. I will need to 
test them before I can sanction them. I also want to standardize all 
information that is stored in Globus Groups for all the groups. Currently there 
are several different formats. </p>
<h3 id="moving-connect-db-to-a-real-db">Moving connect DB to a real DB<a class="headerlink" href="#moving-connect-db-to-a-real-db" title="Permanent link">&para;</a></h3>
<p>The data volume is not that large and the JSON file is sufficient to store all 
the information. Down the road, we might want split from Globus and at this 
point we need to retrieve all the data from Globus. Storing this data would 
need a database.</p>
<h3 id="multiple-connect-globus-apps">Multiple Connect Globus Apps<a class="headerlink" href="#multiple-connect-globus-apps" title="Permanent link">&para;</a></h3>
<p>Branded websites in Globus are mapped one-to-one to a specific Globus App. To 
have different branded website for the various connect instances, we would need 
multiple Globus Apps. Tokens are app-specific, so for users that are members of 
multiple connect instances, for example CI Connect and OSG Connect, we will 
need to keep track of different refresh tokens and apps that they are 
associated with. </p>
                
              
              
                


              
            </article>
          </div>
        </div>
        
      </main>
      
        
<footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        <a href="../projects/" class="md-footer__link md-footer__link--prev" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Projects
            </div>
          </div>
        </a>
      
      
        <a href="../../midscale-engagements/spt/general/" class="md-footer__link md-footer__link--next" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              General
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
        
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../..", "features": [], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}, "search": "../../assets/javascripts/workers/search.fe42c31b.min.js", "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.d892486b.min.js"></script>
      
    
  </body>
</html>